---
title: MVP
layout: post
tags: []
category: iOS
---
## å‰è¨€

è¿™ç¯‡æ–‡ç« ç®€å•åˆ†æä¸‹MVPæ¨¡å¼, ä¹‹å‰è‡ªå·±ä¹Ÿæ²¡æœ‰ä½¿ç”¨è¿‡è¯¥æ¨¡å¼(å¤ªèœğŸ˜…), æ‰€ä»¥ä¾‹å­å’Œåˆ†æä¹Ÿæ˜¯çœ‹å¤§ç¥ä»¬çš„æ–‡ç« (è¯¦æƒ…è§å¼•ç”¨).
MVP(Model-view-presenter)æ˜¯åŸºäºMVCæ¨¡å¼å»¶å±•å¼€æ¥çš„ä¸€ç§è®¾è®¡æ¨¡å¼. å…·æœ‰èŒèƒ½æ›´åŠ åˆ†æ•£, å¯æµ‹è¯•æ€§, ç®€å•æ˜“ç”¨çš„ç‰¹ç‚¹.
ä¸‹é¢æˆ‘ä»¬ä¼šç”¨ç®€å•ä¾‹å­è¾…åŠ©æˆ‘ä»¬ç†è§£è¯¥æ¨¡å¼.

##  MVP
###  æ€»ä½“

![mvp](https://raw.githubusercontent.com/HighmoreXu/BlogImage/master/images/mvp.png "mvp")

ğŸ¤”ï¸ å’ŒMVCæ¯”, MVPå®è§‚ä¸Šæœ‰å“ªäº›ä¸åŒ?

* Presenterå–ä»£äº†ä¹‹å‰Controllerçš„å·¥ä½œ
* ViewControllerä¸ViewåˆäºŒä¸ºä¸€

ä¸‹é¢ä¸¾ä¸ªğŸŒ°æ¥å¸®åŠ©æˆ‘ä»¬ç†è§£è¯¥æ¨¡å¼

modelå±‚:
```
struct GOTHouse {
    let name: String
    let motto: String
    let sigil: String
}

// æ¨¡æ‹Ÿç½‘ç»œè·å–æ•°æ®
class HouseDataService {
    func getHouses(_ callBack: @escaping ([GOTHouse]) -> Void) {
        let houses = [GOTHouse(name: "House Targaryen", motto: "Fire And Blood", sigil: "Dragon"),
                      GOTHouse(name: "House Stark", motto: "Winter Is Coming", sigil: "Wolve"),
                      GOTHouse(name: "House Lannister", motto: "Hear Me Roar", sigil: "Lion")
        ]
        //use delay to simulate network request
        let delayTime = DispatchTime.now() + .seconds(3)
        DispatchQueue.main.asyncAfter(deadline: delayTime) { 
            callBack(houses)
        }
    }
}
```
modelå±‚å’Œä¸Šç¯‡MVCæåˆ°çš„modelèŒèƒ½ç›¸åŒ

presenter:
```
protocol HouseViewProtocol: NSObjectProtocol {
    func showHUD()
    func hideHUD()
    func setHouses(_ houses: [GOTHouse])
    func setEmptyHouses()
}

class HousePresenter {
    fileprivate let dataService: HouseDataService
    weak fileprivate var houseView: HouseViewProtocol?
    
    init(dataService: HouseDataService) {
        self.dataService = dataService
    }
    
    func attachView(_ viewProtocol: HouseViewProtocol) {
        self.houseView = viewProtocol
    }
    
    func detachView() {
        self.houseView = nil
    }
    
    func getHouses() {
        houseView?.showHUD()
        dataService.getHouses{ [weak self] houses in
            self?.houseView?.hideHUD()
            if houses.count == 0 {
                self?.houseView?.setEmptyHouses()
            } else {
                self?.houseView?.setHouses(houses)
            }
        }
    }
}
```
presenterå°†ä¸šåŠ¡é€»è¾‘éƒ½å°è£…åœ¨äº†ä¸€èµ·, è¿æ¥modelå’Œä¼ªview.
å…¶å®é™…å’Œviewåˆæ˜¯ä¸æƒ³å¹²çš„, æ‰€ä»¥å¯ä»¥å¾ˆå¥½çš„è¿›è¡Œå•å…ƒæµ‹è¯•.

viewå±‚:(view + viewcontroller)
```
class ViewController: UIViewController {

    @IBOutlet weak var emptyView: UIView!
    @IBOutlet weak var tableView: UITableView!
    @IBOutlet weak var indicatorView: UIActivityIndicatorView!
    
    fileprivate let presenter = HousePresenter(dataService: HouseDataService())
    fileprivate var houses = [GOTHouse]()
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        tableView.dataSource = self
        indicatorView.hidesWhenStopped = true
        
        presenter.attachView(self)
        presenter.getHouses()
    }
}

//Implement the dataSource
extension ViewController: UITableViewDataSource {
    func numberOfSections(in tableView: UITableView) -> Int {
        return 1
    }
    
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return houses.count
    }
    
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = UITableViewCell(style: .subtitle, reuseIdentifier: "houseCell")
        let houseData = houses[indexPath.row]
        cell.textLabel?.text = houseData.name
        cell.detailTextLabel?.text = houseData.motto
        return cell
    }
}

//Implement the protocol from presenter
extension ViewController: HouseViewProtocol {
    func showHUD() {
        indicatorView.startAnimating()
    }
    
    func hideHUD() {
        indicatorView.stopAnimating()
    }
    
    func setEmptyHouses() {
        tableView.isHidden = true
        emptyView.isHidden = false
    }
    
    func setHouses(_ houses: [GOTHouse]) {
        self.houses = houses
        tableView.isHidden = false
        emptyView.isHidden = true
        tableView.reloadData()
    }
}
```
å¯ä»¥çœ‹åˆ°, viewå±‚ç°åœ¨æ¯”è¾ƒdump, åªæœ‰çº¯ç²¹çš„UIæ›´æ”¹é€»è¾‘.

ğŸ§ æ€»ç»“ä¸€ä¸‹
MVPä¸­, modelå±‚å’ŒMVCçš„modelå±‚ç±»ä¼¼, éƒ½æ˜¯è´Ÿè´£æ•°æ®çš„è·å–åŠç®¡ç†; 
viewå±‚æ›´åŠ çº¯ç²¹, ä¸šåŠ¡é€»è¾‘ç›¸å…³éƒ½å‰¥ç¦»å‡ºå», åªæ˜¯å•çº¯UIViewçš„å±•ç¤ºé€»è¾‘;
presenterå±‚å–ä»£äº†ä¹‹å‰controllerçš„èŒèƒ½: 1) è°ƒç”¨modelå±‚æ¥ç®¡ç†æ•°æ® 2) modelå±‚æ”¹å˜ä»¥å, è´Ÿè´£ç»„è£…æ•°æ®, ç„¶åè®©UIå±‚ä½œå‡ºç›¸åº”çš„æ”¹å˜ 3) UIäº¤äº’ä»¥å, æ¥ç»Ÿç­¹modelçš„æ•°æ®ç®¡ç†
å› ä¸ºpresenterå’ŒUIkitçš„viewæ²¡æœ‰å…³è”, æ‰€ä»¥å¯ä»¥å¾ˆå¥½çš„è¿›è¡Œå•å…ƒæµ‹è¯•.


## å¼•ç”¨

[MVP design pattern in iOS](https://medium.com/@ronanwhite/mvp-design-pattern-in-ios-3b99a40fcabd)

[iOS Architecture Patterns](https://medium.com/ios-os-x-development/ios-architecture-patterns-ecba4c38de52)

[MVP in iOS](https://medium.com/@mohamedraja_77/mvp-in-ios-78fb008b37d1)
